<?xml version="1.0"?>
<launch>

  <node name="image" pkg="vimjay" type="image.py"
      args="$(find vimjay)/data/chess.png"
      output="screen" >
    <remap from="camera_info" to="camera_info_unused" />
  </node>

  <node name="image_view_src" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="image" />
  </node>
  <node name="dr_camera_info" pkg="vimjay" type="dr_camera_info.py"
      output="screen" >
  </node>


  <group if="false">
  <node name="image_proc" pkg="image_proc" type="image_proc"
      output="screen" >
    <remap from="image_raw" to="image" />
    <remap from="camera_info" to="camera_info_unused" />
  </node>
  <node name="image_view_rect" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="image_rect" />
  </node>

  <group ns="redistort" if="true" >
  <node name="distort" pkg="vimjay" type="distort_image"
      output="screen" >
    <remap from="image" to="/image_rect" />
    <remap from="camera_info" to="/camera_info_unused" />
  </node>
  <node name="image_view_distort" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="distorted/image" />
  </node>
  </group>
  </group>


  <group ns="distort" if="true" >
  <node name="distort" pkg="vimjay" type="distort_image"
      output="screen" >
    <remap from="image" to="/image" />
    <remap from="camera_info" to="/camera_info" />
  </node>
  <node name="image_view_distort" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="distorted/image" />
  </node>
  <node name="image_view_debug" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="debug_image" />
  </node>

  <!-- visualize the difference between the input and debug output - should be the same -->
  <node name="gray" pkg="vimjay" type="color"
      output="screen" >
    <!-- would be nice to derive these from CameraInfo input -->
    <param name="width" value="64" />
    <param name="height" value="48" />
    <remap from="image" to="gray" />
  </node>
  <node name="diff_image" pkg="vimjay" type="iir_image" 
      output="screen" >
    <rosparam param="b_coeffs">[1.0, 0.5, -0.5]</rosparam>
    <remap from="image_0" to="gray" />
    <remap from="image_1" to="/image" />
    <remap from="image_2" to="/distort/image_rect" />
    <remap from="filtered_image" to="diff_image" />
  </node>
  <node name="image_view_diff" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="diff_image" />
  </node>

  <group if="true" >
  <node name="image_proc" pkg="image_proc" type="image_proc"
      output="screen" >
    <remap from="image_raw" to="distorted/image" />
    <remap from="camera_info" to="distorted/camera_info" />
  </node>
  <node name="image_view_rect" pkg="image_view" type="image_view"
      output="screen" >
    <remap from="image" to="image_rect_color" />
  </node>
  </group>
  </group>

</launch>
